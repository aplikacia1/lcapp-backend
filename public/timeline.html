<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Li≈°tobook ‚Äì ƒåasov√° os</title>

  <link rel="stylesheet" href="style.css"/>

  <style>
    :root{
      --max-w: 820px; --gap: 16px; --hdr-h: 96px;
      --ui-bg:#eef6ff; --ui-border:#bcd6ff; --ui-text:#0c1f4b; --ui-bg-hover:#e3f0ff;
      --pad-x:12px; --nav-gap:8px; --visible:3;
    }
    html,body{margin:0;padding:0}
    body{background:linear-gradient(135deg,#0c1f4b 0%,#061c47 50%,#0c1f4b 100%);color:#fff;padding-top:var(--hdr-h)}
    body.no-scroll{overflow:hidden}

    /* HLAVIƒåKA */
    .app-header{
      position:fixed;inset:0 0 auto 0;
      z-index:1010; /* nad backdropom */
      background:#0c1f4b;
      border-bottom:1px solid rgba(255,255,255,.15)
    }
    .app-header-inner{max-width:var(--max-w);margin:0 auto;padding:8px var(--pad-x);display:flex;flex-direction:column;align-items:center;position:relative}
    .logo-small{display:block;height:48px;margin:2px auto 6px}
    .user-chip{color:#cfe2ff;font-size:.95rem;margin-bottom:8px}

    /* mobil toggles */
    .nav-toggle,.people-toggle{display:none}
    .burger,.people{
      position:absolute;top:10px;width:44px;height:44px;
      display:none;align-items:center;justify-content:center;
      border:1px solid #ffffff33;border-radius:10px;
      color:#e7eefc;background:transparent;
      cursor:pointer;z-index:1011;
    }
    .burger{left:12px}.people{right:12px}
    .burger svg,.people svg{width:22px;height:22px}
    @media (max-width:767.98px){.burger,.people{display:flex}}

    /* pills */
    .nav-scroller{padding:0 var(--pad-x);width:100%}
    .nav-track{display:flex;gap:var(--nav-gap);overflow-x:auto;overscroll-behavior-x:contain;scrollbar-width:none;justify-content:center}
    .nav-track::-webkit-scrollbar{display:none}
    .pill{
      position:relative;
      flex:0 0 calc((100% - (var(--nav-gap) * (var(--visible) - 1))) / var(--visible));
      height:38px;padding:8px 14px;border-radius:16px;border:1px solid rgba(255,255,255,.35);
      background:#fff;color:#0c1f4b;cursor:pointer;white-space:nowrap;display:inline-flex;align-items:center;gap:8px
    }
    .pill-danger{background:#ff4d4d;color:#fff;border-color:#ff4d4d}
    @media (min-width:768px){.nav-track{overflow:visible}.pill{flex:0 0 auto;width:auto!important}}

    /* mal√Ω ≈ælt√Ω badge na pilulk√°ch (napr. Spr√°vy) */
    .pill-badge{
      margin-left:4px;
      min-width:18px;height:18px;padding:0 6px;
      border-radius:999px;
      background:#ffcc00;
      color:#111;
      font-weight:800;
      font-size:12px;
      display:none;
      align-items:center;
      justify-content:center;
    }

    /* off-canvas (mobil ‚Äì viz triedy na body) */
    @media (max-width:767.98px){
      .app-header .nav-scroller{
        position:fixed;top:0;left:0;height:100vh;width:min(80vw,320px);
        background:#0c1f4b;padding:88px 16px 16px;
        box-shadow:24px 0 36px rgba(0,0,0,.35);
        transform:translateX(-100%);
        transition:transform .25s ease;
        z-index:1002;
      }
      .nav-track{flex-direction:column;gap:10px;overflow:hidden}
      .pill{width:100%!important;height:44px;font-size:1rem;border-radius:14px}
    }

    /* OBSAH */
    .main-content{width:100%;max-width:var(--max-w);margin:24px auto;padding:0 var(--gap);padding-bottom:200px;position:relative;z-index:1}

    /* prav√Ω panel ‚Äì √∫ƒçastn√≠ci */
    .presence-panel{
      position:fixed;right:24px;top:calc(var(--hdr-h) + 16px);
      width:260px;max-height:calc(100vh - var(--hdr-h) - 120px);overflow:auto;
      background:#fff;border:1px solid #e8e8e8;border-radius:12px;
      box-shadow:0 2px 10px rgba(0,0,0,.06);padding:10px;
      z-index:1005;color:#111;
    }
    .presence-title{font-weight:700;color:#0c1f4b;margin-bottom:2px}
    .presence-hint{font-size:.85rem;color:#4b5a86;margin:0 0 8px 0}
    .presence-list{list-style:none;padding:0;margin:0}
    .presence-item{display:flex;align-items:center;gap:8px;padding:6px 4px;border-bottom:1px dotted #eee;cursor:pointer}
    .presence-item:last-child{border-bottom:none}
    .presence-item:hover{background:#f7f7f7}
    .dot{width:10px;height:10px;border-radius:50%;background:#bbb;box-shadow:0 0 0 2px #fff inset,0 0 0 1px #ddd}
    .dot.online{background:#22c55e}
    .presence-name{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .presence-badge{
      margin-left:auto;min-width:18px;height:18px;padding:0 6px;border-radius:999px;
      background:#ffcc00;color:#111;font-weight:800;font-size:12px;
      display:none;align-items:center;justify-content:center;
    }
    .presence-badge:empty{display:none}
    @media (max-width:1200px){.presence-panel{display:none}}
    @media (max-width:767.98px){
      .presence-panel{
        display:block;right:0;top:0;height:100vh;width:min(80vw,320px);
        border-radius:0;padding:88px 12px 12px;
        transform:translateX(100%);
        box-shadow:-24px 0 36px rgba(0,0,0,.35);
        z-index:1005;transition:transform .25s ease;
      }
    }

    /* feed */
    .post{background:#fff;border:1px solid #eee;border-radius:12px;padding:12px;margin-bottom:12px;color:#111}
    .post strong{color:#0c1f4b}
    .post-image{max-width:100%;height:auto;border-radius:10px;margin-top:8px}
    .post-head{display:flex;justify-content:space-between;align-items:center;gap:8px}
    .post-author{display:flex;align-items:center;gap:10px}
    .post-author .avatar{
      width:28px;height:28px;border-radius:50%;object-fit:cover;
      flex:0 0 28px;background:#e9eefc;border:1px solid #e5e9f8;
    }

    .comments{margin-top:8px}
    .comments ul{list-style:none;padding-left:0;margin:0 0 8px 0}
    .comments li{
      padding:4px 0;border-bottom:1px dotted #eee;color:#111;
      display:flex;justify-content:space-between;gap:8px;
    }
    .comment-text{flex:1;min-width:0}
    .link-btn{
      background:transparent;border:none;color:#0c1f4b;cursor:pointer;
      padding:4px 8px;border-radius:8px;
    }
    .link-btn:hover{background:rgba(12,31,75,.08)}

    /* spodn√° li≈°ta + banner/info */
    .composer-bar{
      position:fixed;left:0;right:0;bottom:0;z-index:950;
      background:#0c1f4b;border-top:1px solid rgba(255,255,255,.12);
      display:flex;justify-content:center;padding:10px 12px;
    }
    .composer-wrap{
      width:100%;max-width:var(--max-w);padding:0 var(--gap);
      display:flex;flex-direction:column;gap:10px;
      position:relative;z-index:1;
    }
    .composer{background:#fff;border:1px solid #eee;border-radius:14px;padding:10px}
    .composer-row{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center}
    .input-group{
      display:flex;align-items:center;gap:8px;width:100%;
      background:var(--ui-bg);border:1px solid var(--ui-border);
      border-radius:12px;padding:6px 8px;box-sizing:border-box;
    }
    #timelineForm .composer-input{
      flex:1 1 auto;min-width:0;height:28px;padding:0 8px;
      border:none;outline:none;background:transparent;
      color:#111;caret-color:#111;font-weight:500;
    }
    #composerCount{margin-left:6px;font-size:12px;color:#667;white-space:nowrap}
    .button{
      height:40px;display:inline-flex;align-items:center;justify-content:center;
      padding:0 12px;border:1px solid var(--ui-border);border-radius:12px;
      background:var(--ui-bg);color:#0c1f4b;cursor:pointer;white-space:nowrap;
    }
    .button:hover{background:var(--ui-bg-hover)}
    .button--icon{width:48px;padding:0;font-size:18px}

    .mini-banner{
      height:90px;border-radius:14px;overflow:hidden;
      box-shadow:0 8px 18px rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.18);background:#061c47;
    }
    .mini-banner img{width:100%;height:100%;object-fit:cover;display:block}
    @media (min-width:992px){#miniBannerSlot{display:none!important}}

    .desktop-infobar{display:none}
    @media (min-width:992px){
      .desktop-infobar{
        display:block;height:30px;line-height:30px;text-align:center;
        font-size:12px;color:#cfe2ff;
        background:rgba(7,18,44,.92);
        border:1px solid rgba(255,255,255,.12);border-radius:10px;
        backdrop-filter:blur(6px);
      }
    }

    /* MAL√â BOƒåN√â BANNERY (iba PC) */
    .side-banner-slot{
      position:fixed;
      top:calc(var(--hdr-h) + 40px);
      width:180px;
      height:120px;
      border-radius:12px;
      overflow:hidden;
      box-shadow:0 10px 24px rgba(0,0,0,.4);
      border:1px solid rgba(255,255,255,.22);
      background:#020617;
      display:none;
      z-index:900; /* pod panelom pou≈æ√≠vateƒæov */
    }
    .side-banner-slot img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .side-banner-slot--left{left:18px;}
    /* vpravo nech√°me miesto pre panel pou≈æ√≠vateƒæov (right:24px + width:260px ~= 284) */
    .side-banner-slot--right{right:290px;}

    @media (max-width:991.98px){
      .side-banner-slot{display:none!important;}
    }

    /* pre istotu skryjeme pr√≠padn√Ω star√Ω spodn√Ω banner na PC */
    @media (min-width:992px){
      img[alt="Banner"]{display:none!important;}
    }

    /* PROFIL ‚Äì MODAL (vyƒçaƒçkan√Ω :) ) */
    .profile-backdrop{
      position:fixed;inset:0;
      display:none;align-items:center;justify-content:center;
      background:rgba(0,0,0,.55);
      z-index:1100;
    }
    .profile-modal{
      width:100%;max-width:380px;
      background:
        radial-gradient(circle at 0 0,#1d4ed8 0,rgba(15,23,42,0.96) 52%,#020617 100%);
      color:#e5edff;
      border-radius:18px;
      padding:18px 18px 16px;
      box-shadow:0 24px 60px rgba(3,7,18,.96);
      box-sizing:border-box;
      position:relative;
      border:1px solid rgba(129,140,248,.9);
    }
    .profile-header{
      display:flex;align-items:center;gap:12px;
      margin-bottom:12px;
      padding-bottom:10px;
      border-bottom:1px solid rgba(148,163,255,.38);
    }
    .profile-avatar{
      width:56px;height:56px;border-radius:50%;object-fit:cover;
      background:#020617;border:2px solid rgba(191,219,254,.9);
      box-shadow:0 0 0 2px rgba(15,23,42,1),0 0 22px rgba(59,130,246,.75);
      flex-shrink:0;
    }
    .profile-name{font-weight:700;color:#f9fafb;font-size:1.05rem}
    .profile-city{font-size:.85rem;color:#a5b4fc;margin-top:2px}
    .profile-row{margin-bottom:8px}
    .profile-label{
      font-size:.75rem;text-transform:uppercase;
      letter-spacing:.13em;color:#9ca3af;margin-bottom:3px;
    }
    .profile-value{
      font-size:.9rem;color:#e5edff;
      white-space:pre-wrap;word-break:break-word;
      background:linear-gradient(135deg,rgba(15,23,42,.9),rgba(30,64,175,.95));
      border-radius:10px;
      padding:6px 9px;
      border:1px solid rgba(148,163,255,.6);
    }
    .profile-row--company .profile-label::before{
      content:"Firma ¬∑ ";
      text-transform:none;
      letter-spacing:0;
      font-size:.8rem;
      font-weight:500;
      color:#e5edff;
      margin-right:4px;
    }
    .profile-row--web .profile-label::before{
      content:"Web ¬∑ ";
      text-transform:none;
      letter-spacing:0;
      font-size:.8rem;
      font-weight:500;
      color:#e5edff;
      margin-right:4px;
    }
    .profile-row--web .profile-value a{
      color:#bfdbfe;
      text-decoration:none;
      font-weight:500;
    }
    .profile-row--web .profile-value a:hover{
      text-decoration:underline;
    }
    .profile-empty{
      font-size:.88rem;color:#9ca3af;
      margin:6px 0 4px;
      font-style:italic;
    }
    .profile-actions{
      display:flex;gap:8px;margin-top:12px;
      flex-wrap:wrap;
    }
    .profile-close{
      position:absolute;top:8px;right:10px;
      border:none;background:transparent;
      color:#9ca3af;font-size:22px;line-height:1;
      cursor:pointer;
    }
    .profile-close:hover{color:#e5edff}
    .button--ghost{
      background:transparent;
      border-color:rgba(148,163,255,.7);
      color:#e5edff;
    }
    .profile-modal .button{
      flex:1 1 auto;
      height:40px;
      border-radius:999px;
      border:none;
      background:linear-gradient(135deg,#60a5fa,#2563eb);
      color:#f9fafb;
      box-shadow:0 14px 30px rgba(37,99,235,.55);
      font-weight:600;
      justify-content:center;
    }
    .profile-modal .button:hover{
      filter:brightness(1.05);
    }
    .profile-modal .button--ghost{
      background:transparent;
      box-shadow:none;
    }
    @media (max-width:480px){
      .profile-modal{
        margin:0 12px;
        padding:16px 14px 14px;
      }
    }

    /* TOASTY */
    .toast-stack{
      position:fixed;top:calc(var(--hdr-h) + 12px);left:50%;
      transform:translateX(-50%);
      display:grid;gap:8px;z-index:1200;
      width:min(92vw,520px);pointer-events:none;
    }
    .toast{
      pointer-events:auto;display:flex;align-items:flex-start;gap:10px;
      background:#0b1536;color:#e9f2ff;
      border:1px solid #2a3b8f;border-radius:12px;
      padding:10px 12px;
      box-shadow:0 10px 24px rgba(0,0,0,.35);
    }
    .toast.success{border-color:#1f8f4a}
    .toast.info{border-color:#2a6ad8}
    .toast.warn{border-color:#d6a21e}
    .toast.error{border-color:#d44242}
    .toast .t-ico{font-weight:800;min-width:18px}
    .toast .t-msg{flex:1}
    .toast .t-x{
      appearance:none;border:none;background:transparent;
      color:#cfe2ff;cursor:pointer;font-size:18px;
      line-height:1;padding:0 4px;
    }

    /* NE√ìNOV√â KRAJE (PC only) */
    @media (min-width:992px){
      .neon-beams{
        position:fixed;inset:var(--hdr-h) 0 0 0;
        pointer-events:none;z-index:0;
      }
      .beam{
        position:absolute;top:0;bottom:0;width:12vw;max-width:180px;
        filter:blur(12px);opacity:.22;
        background:
          linear-gradient(180deg,rgba(33,102,214,0) 0%,rgba(33,102,214,.6) 50%,rgba(33,102,214,0) 100%),
          linear-gradient(90deg,rgba(88,173,255,0) 0%,rgba(88,173,255,.55) 40%,rgba(88,173,255,0) 100%);
        animation:beamPulse 5.5s ease-in-out infinite,
                   beamDrift 12s ease-in-out infinite;
        will-change:opacity,transform;
      }
      .beam.left{left:0;transform-origin:left center}
      .beam.right{right:0;transform-origin:right center}
      @keyframes beamPulse{
        0%,100%{opacity:.18}
        50%{opacity:.32}
      }
      @keyframes beamDrift{
        0%,100%{transform:translateY(0) scaleX(1)}
        50%{transform:translateY(-2%) scaleX(1.06)}
      }
      .glow{
        position:absolute;top:12%;
        width:18vw;max-width:240px;height:18vw;max-height:240px;
        background:radial-gradient(circle,rgba(88,173,255,.35) 0%,rgba(88,173,255,0) 60%);
        filter:blur(24px);opacity:.15;
        animation:glowPulse 7s ease-in-out infinite;
      }
      .glow.left{left:-6vw}
      .glow.right{right:-6vw;animation-delay:1.5s}
      @keyframes glowPulse{
        0%,100%{opacity:.10;transform:scale(1)}
        50%{opacity:.22;transform:scale(1.08)}
      }
    }

    /* --- DOPLNOK: triedy na <body> (spoƒæahliv√© v mobile) --- */
    @media (max-width:767.98px){
      body.open-nav .app-header .nav-scroller{transform:translateX(0)}
      body.open-people .presence-panel{transform:translateX(0)}
    }

    /* --- Backdrop pre off-canvas (klikom zavrie) --- */
    .oc-backdrop{
      display:none;position:fixed;inset:0;
      z-index:1003; /* nad obsahom, POD hlaviƒçkou a panelom */
      background:rgba(0,0,0,.3);
      -webkit-tap-highlight-color: transparent;
    }
    body.open-nav .oc-backdrop,
    body.open-people .oc-backdrop{display:block}
  </style>

  <link rel="stylesheet" href="/css/timeline.comment-fix.css?v=fixA1">
</head>
<body>
  <!-- skryt√© checkboxy (zvy≈°ok) -->
  <input type="checkbox" id="navToggle" class="nav-toggle" aria-hidden="true" />
  <input type="checkbox" id="peopleToggle" class="people-toggle" aria-hidden="true" />

  <!-- HLAVIƒåKA -->
  <header class="app-header" role="banner">
    <div class="app-header-inner">
      <button type="button" class="burger" aria-label="Menu" id="burgerBtn">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M3 6h18M3 12h18M3 18h18"
                stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      <button type="button" class="people" aria-label="√öƒçastn√≠ci" id="peopleBtn">
        <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <circle cx="9" cy="8" r="3" stroke="currentColor" stroke-width="2"/>
          <path d="M2 20c0-3.5 3-6 7-6"
                stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <circle cx="17" cy="10" r="2" stroke="currentColor" stroke-width="2"/>
          <path d="M14 20c0-2.2 1.8-4 4-4"
                stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>

      <img src="logo_lc.jpg" alt="Li≈°tov√© centrum" class="logo-small">
      <div class="user-chip" id="loggedUser">Prihl√°sen√Ω ako:</div>

      <nav class="nav-scroller" aria-label="Hlavn√© sekcie">
        <div class="nav-track">
          <button class="pill" id="accountBtn">üßë‚Äçüíº √öƒçet</button>
          <button class="pill" id="funBtn">üé≤ Voƒæn√Ω ƒças</button>
          <button class="pill" id="rateBtn">‚≠ê Hodnotenie tovarov</button>
          <!-- NOV√â: kalkulaƒçky -->
          <button class="pill" id="calcBtn">üìê Kalkulaƒçky</button>
          <!-- Spr√°vy + ≈ælt√Ω badge (≈°tart skryt√©) -->
          <button class="pill" id="messagesBtn" style="display:none;">
            üí¨ Spr√°vy
            <span id="messagesBadge" class="pill-badge"></span>
          </button>
          <button class="pill pill-danger" id="logoutBtn">üö™ Odhl√°si≈• sa</button>
        </div>
      </nav>
    </div>
  </header>

  <!-- NE√ìNOV√â PRUHY (PC) -->
  <div class="neon-beams" aria-hidden="true">
    <span class="beam left"></span>
    <span class="beam right"></span>
    <span class="glow left"></span>
    <span class="glow right"></span>
  </div>

  <!-- MAL√â BOƒåN√â BANNERY (PC) -->
  <div id="desktopBannerLeft" class="side-banner-slot side-banner-slot--left" aria-hidden="true"></div>
  <div id="desktopBannerRight" class="side-banner-slot side-banner-slot--right" aria-hidden="true"></div>

  <!-- PRAV√ù PANEL ‚Äì POU≈Ω√çVATELIA -->
  <aside id="presencePanel" class="presence-panel">
    <div class="presence-title">Pou≈æ√≠vatelia</div>
    <div class="presence-hint">≈§ukni na meno pre <strong>profil</strong> alebo <em>spr√°vu</em>.</div>
    <ul id="presenceList" class="presence-list"></ul>
  </aside>

  <!-- OBSAH -->
  <div class="main-content">
    <div class="post-feed" id="postFeed"></div>
  </div>

  <!-- SPODN√Å LI≈†TA -->
  <div class="composer-bar" id="composerBar">
    <div class="composer-wrap">
      <form id="timelineForm" class="composer" autocomplete="off" enctype="multipart/form-data">
        <div class="composer-row">
          <div class="input-group">
            <input id="postContent" class="composer-input" type="text"
                   placeholder="Nap√≠≈° nieƒço..." maxlength="300" data-preserve />
            <span id="composerCount">0 / 300</span>
            <input id="postImage" type="file" accept="image/*" hidden />
          </div>
          <button type="button" id="postImageBtn" class="button button--icon" aria-label="Prida≈• obr√°zok">üìé</button>
          <button id="postSubmit" class="button" type="submit" disabled>Odosla≈•</button>
        </div>
      </form>

      <!-- mobil: banner -->
      <div id="miniBannerSlot" class="mini-banner" aria-live="polite"></div>

      <!-- PC: info p√°sik -->
      <div id="desktopInfo" class="desktop-infobar" role="contentinfo">
        Li≈°tobook by Li≈°tov√© centrum EU, s.r.o. ¬©, Sasinkova 13, 010 01 ≈Ωilina ‚Äî 2025, verzia 1.0
      </div>
    </div>
  </div>

  <!-- PROFILOV√ù MODAL -->
  <div id="profileBackdrop" class="profile-backdrop" aria-hidden="true">
    <div class="profile-modal" role="dialog" aria-modal="true" aria-labelledby="profileName">
      <button type="button" id="profileCloseBtn" class="profile-close" aria-label="Zavrie≈•">√ó</button>

      <div class="profile-header">
        <img id="profileAvatar" class="profile-avatar" src="/img/avatar_default.png" alt="Avatar pou≈æ√≠vateƒæa">
        <div>
          <div id="profileName" class="profile-name">Pou≈æ√≠vateƒæ</div>
          <div id="profileCity" class="profile-city">‚Äî</div>
        </div>
      </div>

      <div id="profileCompanyRow" class="profile-row profile-row--company">
        <div class="profile-label">Firma</div>
        <div id="profileCompany" class="profile-value"></div>
      </div>

      <div id="profileWebsiteRow" class="profile-row profile-row--web">
        <div class="profile-label">Web</div>
        <div id="profileWebsite" class="profile-value"></div>
      </div>

      <div id="profileBioRow" class="profile-row">
        <div class="profile-label">O mne</div>
        <div id="profileBio" class="profile-value"></div>
      </div>

      <div id="profileEmptyRow" class="profile-empty">
        Tento pou≈æ√≠vateƒæ zatiaƒæ nem√° vyplnen√Ω profil.
      </div>

      <div class="profile-actions">
        <button type="button" id="profileMsgBtn" class="button">Nap√≠sa≈• spr√°vu</button>
        <button type="button" id="profileEditBtn" class="button button--ghost" style="display:none;">
          Upravi≈• profil
        </button>
      </div>
    </div>
  </div>

  <!-- Toasty -->
  <div id="toastStack" class="toast-stack" aria-live="polite" aria-atomic="true"></div>

  <!-- Backdrop pre off-canvas -->
  <div id="ocBackdrop" class="oc-backdrop" aria-hidden="true"></div>

  <!-- cookies ‚Äì banner + funkcie -->
  <script src="/js/cookies.js"></script>

  <!-- config + badge + timeline logika + bannery -->
  <script src="/js/config.js"></script>
  <script src="/js/unread-badge.js"></script>
  <script src="timeline.js"></script>
  <script src="banners.js"></script>

  <!-- helper pre mount bannera len na mobile + boƒçn√© bannery na PC -->
  <script>
    function mountBannerMobileOnly(slotId, options){
      const mql  = window.matchMedia('(max-width: 991.98px)');
      const slot = document.getElementById(slotId);
      if (!slot) return;
      function mount(){
        if (slot.dataset.mounted || !window.mountBannerRotator) return;
        slot.style.display='';
        window.mountBannerRotator(slotId, options);
        slot.dataset.mounted='1';
      }
      function unmount(){
        slot.innerHTML='';
        slot.style.display='none';
        delete slot.dataset.mounted;
      }
      function update(){ mql.matches ? mount() : unmount(); }
      update();
      mql.addEventListener ? mql.addEventListener('change', update) : mql.addListener(update);
    }

    function mountSideBannersDesktopOnly(leftId, rightId, options){
      const mql = window.matchMedia('(min-width: 992px)');
      const left  = document.getElementById(leftId);
      const right = document.getElementById(rightId);
      if (!left || !right) return;

      function mountOne(slot){
        if (!window.mountBannerRotator || slot.dataset.mounted) return;
        slot.style.display = '';
        window.mountBannerRotator(slot.id, options);
        slot.dataset.mounted = '1';
      }

      function mount(){
        mountOne(left);
        mountOne(right);
      }
      function unmount(){
        [left,right].forEach(slot=>{
          slot.innerHTML='';
          slot.style.display='none';
          delete slot.dataset.mounted;
        });
      }
      function update(){ mql.matches ? mount() : unmount(); }
      update();
      mql.addEventListener ? mql.addEventListener('change', update) : mql.addListener(update);
    }
  </script>

  <!-- init: v√Ω≈°ka hlaviƒçky, navig√°cia, hamburgery, bannery + badge Spr√°vy -->
  <script>
    (function(){
      const stack = document.getElementById('toastStack');
      const MAX = 3;
      const ESC = s => String(s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));
      const icons = { success:'‚úì', info:'‚ÑπÔ∏é', warn:'!', error:'√ó' };
      function push(type='info', message='', {duration=4000}={}){
        if (!stack) return;
        while (stack.children.length >= MAX) stack.firstElementChild?.remove();
        const el = document.createElement('div');
        el.className = `toast ${type}`;
        el.innerHTML = `<div class="t-ico">${icons[type]||'‚ÑπÔ∏é'}</div><div class="t-msg">${ESC(message)}</div><button class="t-x" aria-label="Zavrie≈•">√ó</button>`;
        stack.appendChild(el);
        const killer = setTimeout(()=> el.remove(), duration);
        el.querySelector('.t-x')?.addEventListener('click', ()=>{ clearTimeout(killer); el.remove(); });
      }
      window.toast = {
        show:(t,m,o)=>push(t,m,o),
        success:(m,o)=>push('success',m,o),
        info:(m,o)=>push('info',m,o),
        warn:(m,o)=>push('warn',m,o),
        error:(m,o)=>push('error',m,o)
      };
    })();

    document.addEventListener('DOMContentLoaded', () => {
      // dopoƒçet v√Ω≈°ky hlaviƒçky ‚Üí padding top
      const header = document.querySelector('.app-header');
      const setHdrH = () => {
        if (!header) return;
        const h = header.getBoundingClientRect().height;
        document.documentElement.style.setProperty('--hdr-h', h + 'px');
      };
      setHdrH();
      window.addEventListener('resize', setHdrH);

      // navig√°cia (presun medzi str√°nkami)
      const email = new URLSearchParams(window.location.search).get("email");
      const go = (page) => {
        window.location.href = email ? `${page}?email=${encodeURIComponent(email)}` : page;
      };
      document.getElementById('accountBtn')?.addEventListener('click', ()=> go('dashboard.html'));
      document.getElementById('funBtn')?.addEventListener('click', ()=> go('entertainment.html'));
      document.getElementById('rateBtn')?.addEventListener('click', ()=> go('catalog.html'));
      document.getElementById('calcBtn')?.addEventListener('click', ()=> go('calc_index.html'));
      document.getElementById('messagesBtn')?.addEventListener('click', ()=> go('messages.html'));
      document.getElementById('logoutBtn')?.addEventListener('click', ()=> go('index.html'));

      // ≈ælt√Ω badge pre Spr√°vy ‚Äì naƒç√≠tanie nepreƒç√≠tan√Ωch
      const badgeEl = document.getElementById('messagesBadge');
      const messagesBtn = document.getElementById('messagesBtn');

      async function refreshMessagesUnread(){
        if (!email || !badgeEl) return;
        try{
          const r = await fetch(`/api/messages/conversations/${encodeURIComponent(email)}`);
          if (!r.ok) return;
          const list = await r.json();
          let total = 0;
          (list || []).forEach(item => { total += item.unread || 0; });
          if (total > 0){
            // zobraz tlaƒçidlo Spr√°vy
            if (messagesBtn) messagesBtn.style.display = 'inline-flex';
            badgeEl.textContent = total > 9 ? '9+' : String(total);
            badgeEl.style.display = 'inline-flex';
            badgeEl.setAttribute(
              'aria-label',
              total === 1 ? '1 nepreƒç√≠tan√° spr√°va' : `${total} nepreƒç√≠tan√Ωch spr√°v`
            );
          } else {
            // skry tlaƒçidlo Spr√°vy
            if (messagesBtn) messagesBtn.style.display = 'none';
            badgeEl.textContent = '';
            badgeEl.style.display = 'none';
            badgeEl.removeAttribute('aria-label');
          }
        }catch{}
      }

      refreshMessagesUnread();
      setInterval(() => {
        if (!document.hidden) refreshMessagesUnread();
      }, 5000);
      document.addEventListener('visibilitychange', () => {
        if (!document.hidden) refreshMessagesUnread();
      });

      // hamburgery ‚Äì offcanvas cez triedy na <body>
      const burgerBtn  = document.getElementById('burgerBtn');
      const peopleBtn  = document.getElementById('peopleBtn');
      const ocBackdrop = document.getElementById('ocBackdrop');

      function anyOpen(){
        return document.body.classList.contains('open-nav') ||
               document.body.classList.contains('open-people');
      }
      function updateLock(){
        document.body.classList.toggle('no-scroll', anyOpen());
      }
      function closeAll(){
        document.body.classList.remove('open-nav','open-people');
        updateLock();
      }

      burgerBtn?.addEventListener('click', (e)=>{
        e.stopPropagation();
        const wasOpen = document.body.classList.contains('open-nav');
        document.body.classList.remove('open-people');
        document.body.classList.toggle('open-nav', !wasOpen);
        updateLock();
      });

      peopleBtn?.addEventListener('click', (e)=>{
        e.stopPropagation();
        const wasOpen = document.body.classList.contains('open-people');
        document.body.classList.remove('open-nav');
        document.body.classList.toggle('open-people', !wasOpen);
        updateLock();
      });

      // backdrop ‚Äì zavrie panely
      ocBackdrop?.addEventListener('click', closeAll, {passive:true});

      // mobil banner mount
      mountBannerMobileOnly('miniBannerSlot', {
        fixed:false, interval:7000,
        height:80, heightMobile:90
      });

      // boƒçn√© bannery na PC
      mountSideBannersDesktopOnly('desktopBannerLeft','desktopBannerRight',{
        interval:5000,
        height:120
      });
    });
  </script>
</body>
</html>
